-- Kaio Hub (LocalScript) - pronta para colar em StarterGui
-- Recursos: nome "Kaio-dono----Miguel-admin", expandir/recolher, Fly (analógico/teclado) [On/Off],
-- ESP (vermelho) (movido para baixo do Speed), Infinite Jump, Noclip (toggle via On/Off), Speed (0-250)
-- Comentários e textos em pt-br
-- Adicionado: Teleport ao clicar (toggle) — ativa e ao clicar com o mouse o personagem é teleportado para o local clicado.
-- Ajustes: ESP removido dos toggles extras e posicionado abaixo do Speed na inicial; expand/collapse funcionando;
--         fechamento do GUI limpa corretamente conexões e estados.

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

local existingGui = playerGui:FindFirstChild("KaioHubGui")
if existingGui then
	existingGui:Destroy()
end

local WINDOW_SIZE = UDim2.new(0, 220, 0, 150)
local EXPANDED_HEIGHT = 320 -- aumentado para comportar mais toggles (ajustado para Teleport)
local COLLAPSED_HEIGHT = 150

local screenGui = Instance.new("ScreenGui")
screenGui.Name = "KaioHubGui"
screenGui.ResetOnSpawn = false
screenGui.Parent = playerGui

local frame = Instance.new("Frame")
frame.Name = "KaioHubWindow"
frame.Size = WINDOW_SIZE
frame.Position = UDim2.new(0.05, 0, 0.05, 0)
frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
frame.BorderSizePixel = 2
frame.BorderColor3 = Color3.fromRGB(255, 0, 0)
frame.Active = true
frame.Draggable = true
frame.Parent = screenGui

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 8)
corner.Parent = frame

local title = Instance.new("TextLabel")
title.Name = "Title"
title.Size = UDim2.new(1, -30, 0, 34)
title.Position = UDim2.new(0, 6, 0, 6)
title.BackgroundTransparency = 1
title.Text = "Kaio-dono----Miguel-admin"
title.TextColor3 = Color3.fromRGB(255, 80, 80)
title.Font = Enum.Font.GothamBold
title.TextSize = 13
title.TextXAlignment = Enum.TextXAlignment.Left
title.Parent = frame

local closeButton = Instance.new("TextButton")
closeButton.Name = "CloseButton"
closeButton.Size = UDim2.new(0, 22, 0, 22)
closeButton.Position = UDim2.new(1, -26, 0, 6)
closeButton.BackgroundColor3 = Color3.fromRGB(220, 38, 38)
closeButton.Text = "X"
closeButton.Font = Enum.Font.GothamBold
closeButton.TextSize = 14
closeButton.TextColor3 = Color3.fromRGB(255,255,255)
closeButton.Parent = frame
Instance.new("UICorner", closeButton).CornerRadius = UDim.new(0, 6)

local expandBtn = Instance.new("TextButton")
expandBtn.Name = "ExpandButton"
expandBtn.Size = UDim2.new(0, 22, 0, 22)
expandBtn.Position = UDim2.new(1, -56, 0, 6)
expandBtn.BackgroundColor3 = Color3.fromRGB(60,60,60)
expandBtn.Text = ">"
expandBtn.Font = Enum.Font.GothamBold
expandBtn.TextSize = 14
expandBtn.TextColor3 = Color3.fromRGB(255,255,255)
expandBtn.Parent = frame
Instance.new("UICorner", expandBtn).CornerRadius = UDim.new(0, 6)

local status = Instance.new("TextLabel")
status.Name = "Status"
status.Size = UDim2.new(1, -12, 0, 18)
status.Position = UDim2.new(0, 6, 0, 46)
status.BackgroundTransparency = 1
status.Text = "Desligado"
status.TextColor3 = Color3.fromRGB(200,200,200)
status.Font = Enum.Font.Gotham
status.TextSize = 13
status.TextXAlignment = Enum.TextXAlignment.Left
status.Parent = frame

local speedFrame = Instance.new("Frame")
speedFrame.Name = "SpeedFrame"
speedFrame.Size = UDim2.new(1, -12, 0, 28)
speedFrame.Position = UDim2.new(0, 6, 0, 68)
speedFrame.BackgroundTransparency = 1
speedFrame.Parent = frame

local speedLabel = Instance.new("TextLabel")
speedLabel.Name = "SpeedLabel"
speedLabel.Size = UDim2.new(0.58, 0, 1, 0)
speedLabel.Position = UDim2.new(0, 0, 0, 0)
speedLabel.BackgroundTransparency = 1
speedLabel.Text = "Speed (0-250):"
speedLabel.TextColor3 = Color3.fromRGB(200,200,200)
speedLabel.Font = Enum.Font.Gotham
speedLabel.TextSize = 13
speedLabel.TextXAlignment = Enum.TextXAlignment.Left
speedLabel.Parent = speedFrame

local speedBox = Instance.new("TextBox")
speedBox.Name = "SpeedBox"
speedBox.Size = UDim2.new(0.28, 0, 1, 0)
speedBox.Position = UDim2.new(0.6, 0, 0, 0)
speedBox.BackgroundColor3 = Color3.fromRGB(20,20,20)
speedBox.TextColor3 = Color3.fromRGB(255,255,255)
speedBox.Font = Enum.Font.Gotham
speedBox.TextSize = 13
speedBox.ClearTextOnFocus = false
speedBox.Text = "16"
speedBox.PlaceholderText = "16"
speedBox.Parent = speedFrame
Instance.new("UICorner", speedBox).CornerRadius = UDim.new(0,6)

local minusBtn = Instance.new("TextButton")
minusBtn.Name = "MinusButton"
minusBtn.Size = UDim2.new(0.07, 0, 1, 0)
minusBtn.Position = UDim2.new(0.87, 0, 0, 0)
minusBtn.Text = "-"
minusBtn.Font = Enum.Font.GothamBold
minusBtn.TextSize = 16
minusBtn.TextColor3 = Color3.fromRGB(255,255,255)
minusBtn.BackgroundColor3 = Color3.fromRGB(60,60,60)
minusBtn.Parent = speedFrame
Instance.new("UICorner", minusBtn).CornerRadius = UDim.new(0,6)

local plusBtn = Instance.new("TextButton")
plusBtn.Name = "PlusButton"
plusBtn.Size = UDim2.new(0.07, 0, 1, 0)
plusBtn.Position = UDim2.new(0.95, 0, 0, 0)
plusBtn.Text = "+"
plusBtn.Font = Enum.Font.GothamBold
plusBtn.TextSize = 16
plusBtn.TextColor3 = Color3.fromRGB(255,255,255)
plusBtn.BackgroundColor3 = Color3.fromRGB(60,60,60)
plusBtn.Parent = speedFrame
Instance.new("UICorner", plusBtn).CornerRadius = UDim.new(0,6)

-- ESP colocado abaixo do Speed na UI inicial (fora dos extras)
local espLabel = Instance.new("TextLabel")
espLabel.Name = "ESPLabel"
espLabel.Size = UDim2.new(0.65, 0, 0, 26)
espLabel.Position = UDim2.new(0, 6, 0, 106) -- logo abaixo do speed
espLabel.BackgroundTransparency = 1
espLabel.Text = "ESP (vermelho)"
espLabel.TextColor3 = Color3.fromRGB(200,200,200)
espLabel.Font = Enum.Font.Gotham
espLabel.TextSize = 13
espLabel.TextXAlignment = Enum.TextXAlignment.Left
espLabel.Parent = frame

local espBtn = Instance.new("TextButton")
espBtn.Name = "ESPButton"
espBtn.Size = UDim2.new(0.32, 0, 0, 24)
espBtn.Position = UDim2.new(0.67, 0, 0, 108)
espBtn.Text = "Off"
espBtn.Font = Enum.Font.GothamBold
espBtn.TextSize = 13
espBtn.BackgroundColor3 = Color3.fromRGB(60,60,60)
espBtn.TextColor3 = Color3.fromRGB(255,255,255)
espBtn.Parent = frame
Instance.new("UICorner", espBtn).CornerRadius = UDim.new(0,6)

-- Frame com toggles extras (colocado na parte inferior quando expandido)
local extraFrame = Instance.new("Frame")
extraFrame.Name = "ExtraFrame"
extraFrame.Size = UDim2.new(1, -12, 0, 150)
extraFrame.Position = UDim2.new(0, 6, 0, 140)
extraFrame.BackgroundTransparency = 1
extraFrame.Visible = false
extraFrame.Parent = frame

local function makeToggle(name, posY)
	local lbl = Instance.new("TextLabel")
	lbl.Size = UDim2.new(0.65, 0, 0, 26)
	lbl.Position = UDim2.new(0, 0, 0, posY)
	lbl.BackgroundTransparency = 1
	lbl.Text = name
	lbl.TextColor3 = Color3.fromRGB(200,200,200)
	lbl.Font = Enum.Font.Gotham
	lbl.TextSize = 13
	lbl.TextXAlignment = Enum.TextXAlignment.Left
	lbl.Parent = extraFrame

	local btn = Instance.new("TextButton")
	btn.Size = UDim2.new(0.32, 0, 0, 24)
	btn.Position = UDim2.new(0.67, 0, 0, posY+2)
	btn.Text = "Off"
	btn.Font = Enum.Font.GothamBold
	btn.TextSize = 13
	btn.BackgroundColor3 = Color3.fromRGB(60,60,60)
	btn.TextColor3 = Color3.fromRGB(255,255,255)
	btn.Parent = extraFrame
	Instance.new("UICorner", btn).CornerRadius = UDim.new(0,6)
	return lbl, btn
end

-- Visual: retirar o ❌ do texto do Fly (pedido) - mantive apenas texto simples
local flyLabel, flyBtn = makeToggle("Avoar (Fly)", 0) -- sem ❌ inicial
local ijLabel, ijBtn = makeToggle("Infinite Jump", 30)
local noclipLabel, noclipBtn = makeToggle("Noclip", 60) -- agora noclip é igual aos outros
local teleportLabel, teleportBtn = makeToggle("Teleportar ao clicar", 90) -- novo toggle

local function showNotification(msg, color)
	local note = Instance.new("TextLabel")
	note.Size = UDim2.new(0, 160, 0, 26)
	note.Position = UDim2.new(1, -170, 1, -60)
	note.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
	note.BackgroundTransparency = 0.3
	note.BorderSizePixel = 0
	note.Text = msg
	note.TextColor3 = color or Color3.fromRGB(255,255,255)
	note.Font = Enum.Font.GothamBold
	note.TextSize = 13
	note.TextTransparency = 0.1
	note.Parent = screenGui
	Instance.new("UICorner", note).CornerRadius = UDim.new(0,8)

	task.spawn(function()
		task.wait(2)
		if note and note.Parent then
			note:Destroy()
		end
	end)
end

-- State variables
local noclipEnabled = false
local noclipConnection
local speedConnection
local flyEnabled = false
local flyConnection
local infiniteJumpEnabled = false
local ijConnection
local espEnabled = false

local teleportEnabled = false
local teleportConnection

local DEFAULT_WALKSPEED = 16
local MIN_SPEED, MAX_SPEED = 0, 250 -- permitido até 250
local speedValue = DEFAULT_WALKSPEED

local espHighlights = {}
local playerCharConnections = {}
local espPlayerAddedConn
local espPlayerRemovingConn

local function clamp(v, a, b)
	if v < a then return a end
	if v > b then return b end
	return v
end

local function applySpeedToCharacter(char)
	if not char then return end
	local humanoid = char:FindFirstChildOfClass("Humanoid")
	if humanoid then
		humanoid.WalkSpeed = clamp(speedValue, MIN_SPEED, MAX_SPEED)
	end
end

local function enableNoclip()
	if noclipEnabled then return end
	noclipEnabled = true
	status.Text = "Ligado (atravessando paredes)"
	status.TextColor3 = Color3.fromRGB(150,255,150)
	noclipBtn.Text = "On"
	showNotification("Noclip: Ativado", Color3.fromRGB(0,255,0))
	if noclipConnection then
		noclipConnection:Disconnect()
		noclipConnection = nil
	end
	noclipConnection = RunService.RenderStepped:Connect(function()
		local char = player.Character
		if char then
			for _, part in ipairs(char:GetDescendants()) do
				if part:IsA("BasePart") then
					part.CanCollide = false
				end
			end
		end
	end)
end

local function disableNoclip()
	if not noclipEnabled then return end
	noclipEnabled = false
	status.Text = "Desligado"
	status.TextColor3 = Color3.fromRGB(200,200,200)
	noclipBtn.Text = "Off"
	showNotification("Noclip: Desativado", Color3.fromRGB(255,80,80))
	if noclipConnection then
		noclipConnection:Disconnect()
		noclipConnection = nil
	end
	local char = player.Character
	if char then
		for _, part in ipairs(char:GetDescendants()) do
			if part:IsA("BasePart") then
				part.CanCollide = true
			end
		end
	end
end

local function startSpeedLoop()
	if speedConnection then return end
	speedConnection = RunService.RenderStepped:Connect(function()
		local char = player.Character
		if char then
			local humanoid = char:FindFirstChildOfClass("Humanoid")
			if humanoid then
				local desired = clamp(speedValue, MIN_SPEED, MAX_SPEED)
				if humanoid.WalkSpeed ~= desired then
					humanoid.WalkSpeed = desired
				end
			end
		end
	end)
end

local function stopSpeedLoop()
	if speedConnection then
		speedConnection:Disconnect()
		speedConnection = nil
	end
end

-- FLY (analógico/teclado)
local flySpeed = 70
local flyVector = Vector3.new(0,0,0)
local flyUp = 0
local flyDown = 0

-- Thumbstick (analógico mobile/gamepad)
UserInputService.InputChanged:Connect(function(input)
	if not flyEnabled then return end
	if input.UserInputType == Enum.UserInputType.Gamepad1 or input.UserInputType == Enum.UserInputType.Touch then
		local pos = input.Position
		if pos then
			flyVector = Vector3.new(pos.X, 0, -pos.Y)
		end
	end
end)

-- WASD/E/Q (PC)
UserInputService.InputBegan:Connect(function(input, gameProcessed)
	if gameProcessed then return end
	if flyEnabled and input.UserInputType == Enum.UserInputType.Keyboard then
		if input.KeyCode == Enum.KeyCode.W then flyVector = Vector3.new(0, 0, -1) end
		if input.KeyCode == Enum.KeyCode.S then flyVector = Vector3.new(0, 0, 1) end
		if input.KeyCode == Enum.KeyCode.A then flyVector = Vector3.new(-1, 0, 0) end
		if input.KeyCode == Enum.KeyCode.D then flyVector = Vector3.new(1, 0, 0) end
		if input.KeyCode == Enum.KeyCode.E then flyUp = 1 end
		if input.KeyCode == Enum.KeyCode.Q then flyDown = 1 end
	end

	-- Global keyboard shortcuts (ex: N para noclip)
	if not gameProcessed and input.UserInputType == Enum.UserInputType.Keyboard then
		if input.KeyCode == Enum.KeyCode.N then
			if noclipEnabled then
				disableNoclip()
			else
				enableNoclip()
			end
		end
	end
end)
UserInputService.InputEnded:Connect(function(input, gameProcessed)
	if gameProcessed then return end
	if flyEnabled and input.UserInputType == Enum.UserInputType.Keyboard then
		if input.KeyCode == Enum.KeyCode.E then flyUp = 0 end
		if input.KeyCode == Enum.KeyCode.Q then flyDown = 0 end
		if input.KeyCode == Enum.KeyCode.W or input.KeyCode == Enum.KeyCode.S or input.KeyCode == Enum.KeyCode.A or input.KeyCode == Enum.KeyCode.D then
			flyVector = Vector3.new(0, 0, 0)
		end
	end
end)

local function enableFly()
	if flyEnabled then return end
	flyEnabled = true
	flyBtn.Text = "On"
	flyLabel.Text = "Avoar (Fly)"
	showNotification("Fly: Ativado", Color3.fromRGB(120, 200, 255))
	if flyConnection then
		flyConnection:Disconnect()
		flyConnection = nil
	end
	flyConnection = RunService.RenderStepped:Connect(function(dt)
		local char = player.Character
		local hrp = char and char:FindFirstChild("HumanoidRootPart")
		local hum = char and char:FindFirstChildOfClass("Humanoid")
		if hrp and hum then
			local move = flyVector + Vector3.new(0, flyUp - flyDown, 0)
			if move.Magnitude > 0 then
				move = move.Unit
				local cam = workspace.CurrentCamera
				local camCF = cam and cam.CFrame
				if camCF then
					move = (camCF.RightVector * move.X + camCF.LookVector * move.Z + Vector3.new(0, move.Y, 0))
				end
				local finalSpeed = flySpeed * (0.9 + clamp(speedValue/100, 0, 0.6))
				pcall(function()
					hrp.AssemblyLinearVelocity = move * finalSpeed
				end)
			else
				pcall(function()
					hrp.AssemblyLinearVelocity = Vector3.new(0, 0, 0)
				end)
			end
		end
	end)
end

local function disableFly()
	if not flyEnabled then return end
	flyEnabled = false
	flyBtn.Text = "Off"
	flyLabel.Text = "Avoar (Fly)"
	showNotification("Fly: Desativado", Color3.fromRGB(255,120,120))
	if flyConnection then
		flyConnection:Disconnect()
		flyConnection = nil
	end
	local char = player.Character
	local hrp = char and char:FindFirstChild("HumanoidRootPart")
	if hrp then
		pcall(function()
			hrp.AssemblyLinearVelocity = Vector3.new(0, 0, 0)
		end)
	end
	flyVector = Vector3.new(0,0,0)
	flyUp = 0
	flyDown = 0
end

-- Infinite Jump
local function enableInfiniteJump()
	if infiniteJumpEnabled then return end
	infiniteJumpEnabled = true
	ijBtn.Text = "On"
	showNotification("Infinite Jump: Ativado", Color3.fromRGB(120, 200, 255))
	if ijConnection then
		ijConnection:Disconnect()
		ijConnection = nil
	end
	ijConnection = UserInputService.JumpRequest:Connect(function()
		local char = player.Character
		local hum = char and char:FindFirstChildOfClass("Humanoid")
		if hum then
			hum:ChangeState(Enum.HumanoidStateType.Jumping)
			hum.Jump = true
		end
	end)
end

local function disableInfiniteJump()
	if not infiniteJumpEnabled then return end
	infiniteJumpEnabled = false
	ijBtn.Text = "Off"
	showNotification("Infinite Jump: Desativado", Color3.fromRGB(255,120,120))
	if ijConnection then
		ijConnection:Disconnect()
		ijConnection = nil
	end
end

-- ESP (Highlights)
local function createHighlightForChar(char)
	if not char or not char:IsA("Model") then return nil end
	local owner = Players:GetPlayerFromCharacter(char)
	if owner == player then return nil end

	local existing = char:FindFirstChild("KaioESP")
	if existing and existing:IsA("Highlight") then
		return existing
	end
	local highlight = Instance.new("Highlight")
	highlight.Name = "KaioESP"
	highlight.Adornee = char
	highlight.FillColor = Color3.fromRGB(255, 0, 0)
	highlight.OutlineColor = Color3.fromRGB(150, 0, 0)
	highlight.FillTransparency = 0.6
	highlight.OutlineTransparency = 0.5
	highlight.Parent = char
	return highlight
end

local function onPlayerCharacterAdded(pl, char)
	if espEnabled and pl ~= player then
		local h = createHighlightForChar(char)
		espHighlights[pl] = h
	end
end

local function enableESP()
	if espEnabled then return end
	espEnabled = true
	espBtn.Text = "On"
	showNotification("ESP: Ativado", Color3.fromRGB(255,100,100))
	for _, pl in ipairs(Players:GetPlayers()) do
		if pl ~= player then
			if pl.Character then
				local h = createHighlightForChar(pl.Character)
				espHighlights[pl] = h
			end
			if not playerCharConnections[pl] then
				playerCharConnections[pl] = pl.CharacterAdded:Connect(function(c) onPlayerCharacterAdded(pl, c) end)
			end
		end
	end
	if not espPlayerAddedConn then
		espPlayerAddedConn = Players.PlayerAdded:Connect(function(pl)
			if pl ~= player then
				playerCharConnections[pl] = pl.CharacterAdded:Connect(function(c) onPlayerCharacterAdded(pl, c) end)
				if pl.Character then
					local h = createHighlightForChar(pl.Character)
					espHighlights[pl] = h
				end
			end
		end)
	end
	if not espPlayerRemovingConn then
		espPlayerRemovingConn = Players.PlayerRemoving:Connect(function(pl)
			local h = espHighlights[pl]
			if h and h.Parent then
				pcall(function() h:Destroy() end)
			end
			espHighlights[pl] = nil

			local conn = playerCharConnections[pl]
			if conn then
				conn:Disconnect()
			end
			playerCharConnections[pl] = nil
		end)
	end
end

local function disableESP()
	if not espEnabled then return end
	espEnabled = false
	espBtn.Text = "Off"
	showNotification("ESP: Desativado", Color3.fromRGB(255,120,120))
	for pl, h in pairs(espHighlights) do
		if h and h.Parent then
			pcall(function() h:Destroy() end)
		end
		espHighlights[pl] = nil
	end
	for pl, conn in pairs(playerCharConnections) do
		if conn then
			pcall(function() conn:Disconnect() end)
		end
		playerCharConnections[pl] = nil
	end
	if espPlayerAddedConn then
		espPlayerAddedConn:Disconnect()
		espPlayerAddedConn = nil
	end
	if espPlayerRemovingConn then
		espPlayerRemovingConn:Disconnect()
		espPlayerRemovingConn = nil
	end
end

-- Teleport ao clicar (nova funcionalidade)
local function teleportCharacterTo(pos)
	local char = player.Character
	if not char then return end
	local hrp = char:FindFirstChild("HumanoidRootPart") or char:FindFirstChild("Torso") or char:FindFirstChild("UpperTorso")
	if not hrp then return end
	pcall(function()
		-- posiciona um pouco acima para evitar prender no chão
		hrp.CFrame = CFrame.new(pos + Vector3.new(0, 3, 0))
		-- limpar velocidade vertical para evitar queda estranha
		if hrp.AssemblyLinearVelocity then
			hrp.AssemblyLinearVelocity = Vector3.new(0,0,0)
		end
	end)
end

local function enableTeleportClick()
	if teleportEnabled then return end
	teleportEnabled = true
	teleportBtn.Text = "On"
	showNotification("Teleport click: Ativado", Color3.fromRGB(120, 200, 255))
	-- usar Mouse para registrar clique do jogador
	local mouse = player:GetMouse()
	if teleportConnection then
		teleportConnection:Disconnect()
		teleportConnection = nil
	end
	teleportConnection = mouse.Button1Down:Connect(function()
		-- evitar teleportar enquanto usuário está digitando em um TextBox da GUI
		if UserInputService:GetFocusedTextBox() then return end
		local hit = mouse.Hit
		local targetPos = (hit and hit.Position) or (hit and hit.p)
		if targetPos then
			teleportCharacterTo(targetPos)
		end
	end)
end

local function disableTeleportClick()
	if not teleportEnabled then return end
	teleportEnabled = false
	teleportBtn.Text = "Off"
	showNotification("Teleport click: Desativado", Color3.fromRGB(255,120,120))
	if teleportConnection then
		teleportConnection:Disconnect()
		teleportConnection = nil
	end
end

-- Keep settings applied when character spawns
player.CharacterAdded:Connect(function(char)
	local humanoid = char:FindFirstChildOfClass("Humanoid") or char:WaitForChild("Humanoid", 2)
	if humanoid then
		applySpeedToCharacter(char)
	end
	task.wait(0.1)
	if noclipEnabled then
		for _, part in ipairs(char:GetDescendants()) do
			if part:IsA("BasePart") then
				part.CanCollide = false
			end
		end
	end
	-- Reapply ESP highlight se ativado
	if espEnabled and char then
		local pl = Players:GetPlayerFromCharacter(char)
		if pl and pl ~= player then
			local h = createHighlightForChar(char)
			espHighlights[pl] = h
		end
	end
end)

-- Event hookups for toggles and controls

-- Speed box change and plus/minus
local function updateSpeedFromBox()
	local n = tonumber(speedBox.Text) or DEFAULT_WALKSPEED
	speedValue = clamp(math.floor(n), MIN_SPEED, MAX_SPEED)
	speedBox.Text = tostring(speedValue)
end

minusBtn.MouseButton1Click:Connect(function()
	updateSpeedFromBox()
	speedValue = clamp(speedValue - 1, MIN_SPEED, MAX_SPEED)
	speedBox.Text = tostring(speedValue)
end)

plusBtn.MouseButton1Click:Connect(function()
	updateSpeedFromBox()
	speedValue = clamp(speedValue + 1, MIN_SPEED, MAX_SPEED)
	speedBox.Text = tostring(speedValue)
end)

speedBox.FocusLost:Connect(function(enterPressed)
	updateSpeedFromBox()
end)

-- ESP toggle (agora abaixo do speed)
espBtn.MouseButton1Click:Connect(function()
	if espEnabled then
		disableESP()
	else
		enableESP()
	end
end)

-- Extra toggles
flyBtn.MouseButton1Click:Connect(function()
	if flyEnabled then
		disableFly()
	else
		enableFly()
	end
end)

ijBtn.MouseButton1Click:Connect(function()
	if infiniteJumpEnabled then
		disableInfiniteJump()
	else
		enableInfiniteJump()
	end
end)

noclipBtn.MouseButton1Click:Connect(function()
	if noclipEnabled then
		disableNoclip()
	else
		enableNoclip()
	end
end)

teleportBtn.MouseButton1Click:Connect(function()
	if teleportEnabled then
		disableTeleportClick()
	else
		enableTeleportClick()
	end
end)

-- Expand/Collapse behavior
local expanded = false
expandBtn.MouseButton1Click:Connect(function()
	expanded = not expanded
	extraFrame.Visible = expanded
	if expanded then
		frame.Size = UDim2.new(0, 220, 0, EXPANDED_HEIGHT)
		expandBtn.Text = "<"
	else
		frame.Size = UDim2.new(0, 220, 0, COLLAPSED_HEIGHT)
		expandBtn.Text = ">"
	end
end)

-- Initial state
disableNoclip()
speedBox.Text = tostring(DEFAULT_WALKSPEED)
speedValue = DEFAULT_WALKSPEED
startSpeedLoop()

-- Close button behavior: reset alguns estados e destruir GUI
closeButton.MouseButton1Click:Connect(function()
	local char = player.Character
	if char then
		local humanoid = char:FindFirstChildOfClass("Humanoid")
		if humanoid then
			humanoid.WalkSpeed = DEFAULT_WALKSPEED
		end
	end

	-- Desativar funcionalidades ativas
	disableNoclip()
	stopSpeedLoop()
	disableFly()
	disableInfiniteJump()
	disableESP()
	disableTeleportClick()

	-- limpar event connections criadas por este script (se existirem)
	if noclipConnection then
		pcall(function() noclipConnection:Disconnect() end)
		noclipConnection = nil
	end
	if speedConnection then
		pcall(function() speedConnection:Disconnect() end)
		speedConnection = nil
	end
	if flyConnection then
		pcall(function() flyConnection:Disconnect() end)
		flyConnection = nil
	end
	if ijConnection then
		pcall(function() ijConnection:Disconnect() end)
		ijConnection = nil
	end
	if teleportConnection then
		pcall(function() teleportConnection:Disconnect() end)
		teleportConnection = nil
	end

	-- destruir a GUI inteira
	if screenGui and screenGui.Parent then
		screenGui:Destroy()
	end
end)-- Kaio Hub (LocalScript) - pronta para colar em StarterGui
-- Recursos: nome "Kaio-dono----Miguel-admin", expandir/recolher, Fly (analógico/teclado) [On/Off],
-- ESP (vermelho) (movido para baixo do Speed), Infinite Jump, Noclip (toggle via On/Off), Speed (0-250)
-- Comentários e textos em pt-br
-- Adicionado: Teleport ao clicar (toggle) — ativa e ao clicar com o mouse o personagem é teleportado para o local clicado.
-- Ajustes: ESP removido dos toggles extras e posicionado abaixo do Speed na inicial; expand/collapse funcionando;
--         fechamento do GUI limpa corretamente conexões e estados.

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

local existingGui = playerGui:FindFirstChild("KaioHubGui")
if existingGui then
	existingGui:Destroy()
end

local WINDOW_SIZE = UDim2.new(0, 220, 0, 150)
local EXPANDED_HEIGHT = 320 -- aumentado para comportar mais toggles (ajustado para Teleport)
local COLLAPSED_HEIGHT = 150

local screenGui = Instance.new("ScreenGui")
screenGui.Name = "KaioHubGui"
screenGui.ResetOnSpawn = false
screenGui.Parent = playerGui

local frame = Instance.new("Frame")
frame.Name = "KaioHubWindow"
frame.Size = WINDOW_SIZE
frame.Position = UDim2.new(0.05, 0, 0.05, 0)
frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
frame.BorderSizePixel = 2
frame.BorderColor3 = Color3.fromRGB(255, 0, 0)
frame.Active = true
frame.Draggable = true
frame.Parent = screenGui

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 8)
corner.Parent = frame

local title = Instance.new("TextLabel")
title.Name = "Title"
title.Size = UDim2.new(1, -30, 0, 34)
title.Position = UDim2.new(0, 6, 0, 6)
title.BackgroundTransparency = 1
title.Text = "Kaio-dono----Miguel-admin"
title.TextColor3 = Color3.fromRGB(255, 80, 80)
title.Font = Enum.Font.GothamBold
title.TextSize = 13
title.TextXAlignment = Enum.TextXAlignment.Left
title.Parent = frame

local closeButton = Instance.new("TextButton")
closeButton.Name = "CloseButton"
closeButton.Size = UDim2.new(0, 22, 0, 22)
closeButton.Position = UDim2.new(1, -26, 0, 6)
closeButton.BackgroundColor3 = Color3.fromRGB(220, 38, 38)
closeButton.Text = "X"
closeButton.Font = Enum.Font.GothamBold
closeButton.TextSize = 14
closeButton.TextColor3 = Color3.fromRGB(255,255,255)
closeButton.Parent = frame
Instance.new("UICorner", closeButton).CornerRadius = UDim.new(0, 6)

local expandBtn = Instance.new("TextButton")
expandBtn.Name = "ExpandButton"
expandBtn.Size = UDim2.new(0, 22, 0, 22)
expandBtn.Position = UDim2.new(1, -56, 0, 6)
expandBtn.BackgroundColor3 = Color3.fromRGB(60,60,60)
expandBtn.Text = ">"
expandBtn.Font = Enum.Font.GothamBold
expandBtn.TextSize = 14
expandBtn.TextColor3 = Color3.fromRGB(255,255,255)
expandBtn.Parent = frame
Instance.new("UICorner", expandBtn).CornerRadius = UDim.new(0, 6)

local status = Instance.new("TextLabel")
status.Name = "Status"
status.Size = UDim2.new(1, -12, 0, 18)
status.Position = UDim2.new(0, 6, 0, 46)
status.BackgroundTransparency = 1
status.Text = "Desligado"
status.TextColor3 = Color3.fromRGB(200,200,200)
status.Font = Enum.Font.Gotham
status.TextSize = 13
status.TextXAlignment = Enum.TextXAlignment.Left
status.Parent = frame

local speedFrame = Instance.new("Frame")
speedFrame.Name = "SpeedFrame"
speedFrame.Size = UDim2.new(1, -12, 0, 28)
speedFrame.Position = UDim2.new(0, 6, 0, 68)
speedFrame.BackgroundTransparency = 1
speedFrame.Parent = frame

local speedLabel = Instance.new("TextLabel")
speedLabel.Name = "SpeedLabel"
speedLabel.Size = UDim2.new(0.58, 0, 1, 0)
speedLabel.Position = UDim2.new(0, 0, 0, 0)
speedLabel.BackgroundTransparency = 1
speedLabel.Text = "Speed (0-250):"
speedLabel.TextColor3 = Color3.fromRGB(200,200,200)
speedLabel.Font = Enum.Font.Gotham
speedLabel.TextSize = 13
speedLabel.TextXAlignment = Enum.TextXAlignment.Left
speedLabel.Parent = speedFrame

local speedBox = Instance.new("TextBox")
speedBox.Name = "SpeedBox"
speedBox.Size = UDim2.new(0.28, 0, 1, 0)
speedBox.Position = UDim2.new(0.6, 0, 0, 0)
speedBox.BackgroundColor3 = Color3.fromRGB(20,20,20)
speedBox.TextColor3 = Color3.fromRGB(255,255,255)
speedBox.Font = Enum.Font.Gotham
speedBox.TextSize = 13
speedBox.ClearTextOnFocus = false
speedBox.Text = "16"
speedBox.PlaceholderText = "16"
speedBox.Parent = speedFrame
Instance.new("UICorner", speedBox).CornerRadius = UDim.new(0,6)

local minusBtn = Instance.new("TextButton")
minusBtn.Name = "MinusButton"
minusBtn.Size = UDim2.new(0.07, 0, 1, 0)
minusBtn.Position = UDim2.new(0.87, 0, 0, 0)
minusBtn.Text = "-"
minusBtn.Font = Enum.Font.GothamBold
minusBtn.TextSize = 16
minusBtn.TextColor3 = Color3.fromRGB(255,255,255)
minusBtn.BackgroundColor3 = Color3.fromRGB(60,60,60)
minusBtn.Parent = speedFrame
Instance.new("UICorner", minusBtn).CornerRadius = UDim.new(0,6)

local plusBtn = Instance.new("TextButton")
plusBtn.Name = "PlusButton"
plusBtn.Size = UDim2.new(0.07, 0, 1, 0)
plusBtn.Position = UDim2.new(0.95, 0, 0, 0)
plusBtn.Text = "+"
plusBtn.Font = Enum.Font.GothamBold
plusBtn.TextSize = 16
plusBtn.TextColor3 = Color3.fromRGB(255,255,255)
plusBtn.BackgroundColor3 = Color3.fromRGB(60,60,60)
plusBtn.Parent = speedFrame
Instance.new("UICorner", plusBtn).CornerRadius = UDim.new(0,6)

-- ESP colocado abaixo do Speed na UI inicial (fora dos extras)
local espLabel = Instance.new("TextLabel")
espLabel.Name = "ESPLabel"
espLabel.Size = UDim2.new(0.65, 0, 0, 26)
espLabel.Position = UDim2.new(0, 6, 0, 106) -- logo abaixo do speed
espLabel.BackgroundTransparency = 1
espLabel.Text = "ESP (vermelho)"
espLabel.TextColor3 = Color3.fromRGB(200,200,200)
espLabel.Font = Enum.Font.Gotham
espLabel.TextSize = 13
espLabel.TextXAlignment = Enum.TextXAlignment.Left
espLabel.Parent = frame

local espBtn = Instance.new("TextButton")
espBtn.Name = "ESPButton"
espBtn.Size = UDim2.new(0.32, 0, 0, 24)
espBtn.Position = UDim2.new(0.67, 0, 0, 108)
espBtn.Text = "Off"
espBtn.Font = Enum.Font.GothamBold
espBtn.TextSize = 13
espBtn.BackgroundColor3 = Color3.fromRGB(60,60,60)
espBtn.TextColor3 = Color3.fromRGB(255,255,255)
espBtn.Parent = frame
Instance.new("UICorner", espBtn).CornerRadius = UDim.new(0,6)

-- Frame com toggles extras (colocado na parte inferior quando expandido)
local extraFrame = Instance.new("Frame")
extraFrame.Name = "ExtraFrame"
extraFrame.Size = UDim2.new(1, -12, 0, 150)
extraFrame.Position = UDim2.new(0, 6, 0, 140)
extraFrame.BackgroundTransparency = 1
extraFrame.Visible = false
extraFrame.Parent = frame

local function makeToggle(name, posY)
	local lbl = Instance.new("TextLabel")
	lbl.Size = UDim2.new(0.65, 0, 0, 26)
	lbl.Position = UDim2.new(0, 0, 0, posY)
	lbl.BackgroundTransparency = 1
	lbl.Text = name
	lbl.TextColor3 = Color3.fromRGB(200,200,200)
	lbl.Font = Enum.Font.Gotham
	lbl.TextSize = 13
	lbl.TextXAlignment = Enum.TextXAlignment.Left
	lbl.Parent = extraFrame

	local btn = Instance.new("TextButton")
	btn.Size = UDim2.new(0.32, 0, 0, 24)
	btn.Position = UDim2.new(0.67, 0, 0, posY+2)
	btn.Text = "Off"
	btn.Font = Enum.Font.GothamBold
	btn.TextSize = 13
	btn.BackgroundColor3 = Color3.fromRGB(60,60,60)
	btn.TextColor3 = Color3.fromRGB(255,255,255)
	btn.Parent = extraFrame
	Instance.new("UICorner", btn).CornerRadius = UDim.new(0,6)
	return lbl, btn
end

-- Visual: retirar o ❌ do texto do Fly (pedido) - mantive apenas texto simples
local flyLabel, flyBtn = makeToggle("Avoar (Fly)", 0) -- sem ❌ inicial
local ijLabel, ijBtn = makeToggle("Infinite Jump", 30)
local noclipLabel, noclipBtn = makeToggle("Noclip", 60) -- agora noclip é igual aos outros
local teleportLabel, teleportBtn = makeToggle("Teleportar ao clicar", 90) -- novo toggle

local function showNotification(msg, color)
	local note = Instance.new("TextLabel")
	note.Size = UDim2.new(0, 160, 0, 26)
	note.Position = UDim2.new(1, -170, 1, -60)
	note.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
	note.BackgroundTransparency = 0.3
	note.BorderSizePixel = 0
	note.Text = msg
	note.TextColor3 = color or Color3.fromRGB(255,255,255)
	note.Font = Enum.Font.GothamBold
	note.TextSize = 13
	note.TextTransparency = 0.1
	note.Parent = screenGui
	Instance.new("UICorner", note).CornerRadius = UDim.new(0,8)

	task.spawn(function()
		task.wait(2)
		if note and note.Parent then
			note:Destroy()
		end
	end)
end

-- State variables
local noclipEnabled = false
local noclipConnection
local speedConnection
local flyEnabled = false
local flyConnection
local infiniteJumpEnabled = false
local ijConnection
local espEnabled = false

local teleportEnabled = false
local teleportConnection

local DEFAULT_WALKSPEED = 16
local MIN_SPEED, MAX_SPEED = 0, 250 -- permitido até 250
local speedValue = DEFAULT_WALKSPEED

local espHighlights = {}
local playerCharConnections = {}
local espPlayerAddedConn
local espPlayerRemovingConn

local function clamp(v, a, b)
	if v < a then return a end
	if v > b then return b end
	return v
end

local function applySpeedToCharacter(char)
	if not char then return end
	local humanoid = char:FindFirstChildOfClass("Humanoid")
	if humanoid then
		humanoid.WalkSpeed = clamp(speedValue, MIN_SPEED, MAX_SPEED)
	end
end

local function enableNoclip()
	if noclipEnabled then return end
	noclipEnabled = true
	status.Text = "Ligado (atravessando paredes)"
	status.TextColor3 = Color3.fromRGB(150,255,150)
	noclipBtn.Text = "On"
	showNotification("Noclip: Ativado", Color3.fromRGB(0,255,0))
	if noclipConnection then
		noclipConnection:Disconnect()
		noclipConnection = nil
	end
	noclipConnection = RunService.RenderStepped:Connect(function()
		local char = player.Character
		if char then
			for _, part in ipairs(char:GetDescendants()) do
				if part:IsA("BasePart") then
					part.CanCollide = false
				end
			end
		end
	end)
end

local function disableNoclip()
	if not noclipEnabled then return end
	noclipEnabled = false
	status.Text = "Desligado"
	status.TextColor3 = Color3.fromRGB(200,200,200)
	noclipBtn.Text = "Off"
	showNotification("Noclip: Desativado", Color3.fromRGB(255,80,80))
	if noclipConnection then
		noclipConnection:Disconnect()
		noclipConnection = nil
	end
	local char = player.Character
	if char then
		for _, part in ipairs(char:GetDescendants()) do
			if part:IsA("BasePart") then
				part.CanCollide = true
			end
		end
	end
end

local function startSpeedLoop()
	if speedConnection then return end
	speedConnection = RunService.RenderStepped:Connect(function()
		local char = player.Character
		if char then
			local humanoid = char:FindFirstChildOfClass("Humanoid")
			if humanoid then
				local desired = clamp(speedValue, MIN_SPEED, MAX_SPEED)
				if humanoid.WalkSpeed ~= desired then
					humanoid.WalkSpeed = desired
				end
			end
		end
	end)
end

local function stopSpeedLoop()
	if speedConnection then
		speedConnection:Disconnect()
		speedConnection = nil
	end
end

-- FLY (analógico/teclado)
local flySpeed = 70
local flyVector = Vector3.new(0,0,0)
local flyUp = 0
local flyDown = 0

-- Thumbstick (analógico mobile/gamepad)
UserInputService.InputChanged:Connect(function(input)
	if not flyEnabled then return end
	if input.UserInputType == Enum.UserInputType.Gamepad1 or input.UserInputType == Enum.UserInputType.Touch then
		local pos = input.Position
		if pos then
			flyVector = Vector3.new(pos.X, 0, -pos.Y)
		end
	end
end)

-- WASD/E/Q (PC)
UserInputService.InputBegan:Connect(function(input, gameProcessed)
	if gameProcessed then return end
	if flyEnabled and input.UserInputType == Enum.UserInputType.Keyboard then
		if input.KeyCode == Enum.KeyCode.W then flyVector = Vector3.new(0, 0, -1) end
		if input.KeyCode == Enum.KeyCode.S then flyVector = Vector3.new(0, 0, 1) end
		if input.KeyCode == Enum.KeyCode.A then flyVector = Vector3.new(-1, 0, 0) end
		if input.KeyCode == Enum.KeyCode.D then flyVector = Vector3.new(1, 0, 0) end
		if input.KeyCode == Enum.KeyCode.E then flyUp = 1 end
		if input.KeyCode == Enum.KeyCode.Q then flyDown = 1 end
	end

	-- Global keyboard shortcuts (ex: N para noclip)
	if not gameProcessed and input.UserInputType == Enum.UserInputType.Keyboard then
		if input.KeyCode == Enum.KeyCode.N then
			if noclipEnabled then
				disableNoclip()
			else
				enableNoclip()
			end
		end
	end
end)
UserInputService.InputEnded:Connect(function(input, gameProcessed)
	if gameProcessed then return end
	if flyEnabled and input.UserInputType == Enum.UserInputType.Keyboard then
		if input.KeyCode == Enum.KeyCode.E then flyUp = 0 end
		if input.KeyCode == Enum.KeyCode.Q then flyDown = 0 end
		if input.KeyCode == Enum.KeyCode.W or input.KeyCode == Enum.KeyCode.S or input.KeyCode == Enum.KeyCode.A or input.KeyCode == Enum.KeyCode.D then
			flyVector = Vector3.new(0, 0, 0)
		end
	end
end)

local function enableFly()
	if flyEnabled then return end
	flyEnabled = true
	flyBtn.Text = "On"
	flyLabel.Text = "Avoar (Fly)"
	showNotification("Fly: Ativado", Color3.fromRGB(120, 200, 255))
	if flyConnection then
		flyConnection:Disconnect()
		flyConnection = nil
	end
	flyConnection = RunService.RenderStepped:Connect(function(dt)
		local char = player.Character
		local hrp = char and char:FindFirstChild("HumanoidRootPart")
		local hum = char and char:FindFirstChildOfClass("Humanoid")
		if hrp and hum then
			local move = flyVector + Vector3.new(0, flyUp - flyDown, 0)
			if move.Magnitude > 0 then
				move = move.Unit
				local cam = workspace.CurrentCamera
				local camCF = cam and cam.CFrame
				if camCF then
					move = (camCF.RightVector * move.X + camCF.LookVector * move.Z + Vector3.new(0, move.Y, 0))
				end
				local finalSpeed = flySpeed * (0.9 + clamp(speedValue/100, 0, 0.6))
				pcall(function()
					hrp.AssemblyLinearVelocity = move * finalSpeed
				end)
			else
				pcall(function()
					hrp.AssemblyLinearVelocity = Vector3.new(0, 0, 0)
				end)
			end
		end
	end)
end

local function disableFly()
	if not flyEnabled then return end
	flyEnabled = false
	flyBtn.Text = "Off"
	flyLabel.Text = "Avoar (Fly)"
	showNotification("Fly: Desativado", Color3.fromRGB(255,120,120))
	if flyConnection then
		flyConnection:Disconnect()
		flyConnection = nil
	end
	local char = player.Character
	local hrp = char and char:FindFirstChild("HumanoidRootPart")
	if hrp then
		pcall(function()
			hrp.AssemblyLinearVelocity = Vector3.new(0, 0, 0)
		end)
	end
	flyVector = Vector3.new(0,0,0)
	flyUp = 0
	flyDown = 0
end

-- Infinite Jump
local function enableInfiniteJump()
	if infiniteJumpEnabled then return end
	infiniteJumpEnabled = true
	ijBtn.Text = "On"
	showNotification("Infinite Jump: Ativado", Color3.fromRGB(120, 200, 255))
	if ijConnection then
		ijConnection:Disconnect()
		ijConnection = nil
	end
	ijConnection = UserInputService.JumpRequest:Connect(function()
		local char = player.Character
		local hum = char and char:FindFirstChildOfClass("Humanoid")
		if hum then
			hum:ChangeState(Enum.HumanoidStateType.Jumping)
			hum.Jump = true
		end
	end)
end

local function disableInfiniteJump()
	if not infiniteJumpEnabled then return end
	infiniteJumpEnabled = false
	ijBtn.Text = "Off"
	showNotification("Infinite Jump: Desativado", Color3.fromRGB(255,120,120))
	if ijConnection then
		ijConnection:Disconnect()
		ijConnection = nil
	end
end

-- ESP (Highlights)
local function createHighlightForChar(char)
	if not char or not char:IsA("Model") then return nil end
	local owner = Players:GetPlayerFromCharacter(char)
	if owner == player then return nil end

	local existing = char:FindFirstChild("KaioESP")
	if existing and existing:IsA("Highlight") then
		return existing
	end
	local highlight = Instance.new("Highlight")
	highlight.Name = "KaioESP"
	highlight.Adornee = char
	highlight.FillColor = Color3.fromRGB(255, 0, 0)
	highlight.OutlineColor = Color3.fromRGB(150, 0, 0)
	highlight.FillTransparency = 0.6
	highlight.OutlineTransparency = 0.5
	highlight.Parent = char
	return highlight
end

local function onPlayerCharacterAdded(pl, char)
	if espEnabled and pl ~= player then
		local h = createHighlightForChar(char)
		espHighlights[pl] = h
	end
end

local function enableESP()
	if espEnabled then return end
	espEnabled = true
	espBtn.Text = "On"
	showNotification("ESP: Ativado", Color3.fromRGB(255,100,100))
	for _, pl in ipairs(Players:GetPlayers()) do
		if pl ~= player then
			if pl.Character then
				local h = createHighlightForChar(pl.Character)
				espHighlights[pl] = h
			end
			if not playerCharConnections[pl] then
				playerCharConnections[pl] = pl.CharacterAdded:Connect(function(c) onPlayerCharacterAdded(pl, c) end)
			end
		end
	end
	if not espPlayerAddedConn then
		espPlayerAddedConn = Players.PlayerAdded:Connect(function(pl)
			if pl ~= player then
				playerCharConnections[pl] = pl.CharacterAdded:Connect(function(c) onPlayerCharacterAdded(pl, c) end)
				if pl.Character then
					local h = createHighlightForChar(pl.Character)
					espHighlights[pl] = h
				end
			end
		end)
	end
	if not espPlayerRemovingConn then
		espPlayerRemovingConn = Players.PlayerRemoving:Connect(function(pl)
			local h = espHighlights[pl]
			if h and h.Parent then
				pcall(function() h:Destroy() end)
			end
			espHighlights[pl] = nil

			local conn = playerCharConnections[pl]
			if conn then
				conn:Disconnect()
			end
			playerCharConnections[pl] = nil
		end)
	end
end

local function disableESP()
	if not espEnabled then return end
	espEnabled = false
	espBtn.Text = "Off"
	showNotification("ESP: Desativado", Color3.fromRGB(255,120,120))
	for pl, h in pairs(espHighlights) do
		if h and h.Parent then
			pcall(function() h:Destroy() end)
		end
		espHighlights[pl] = nil
	end
	for pl, conn in pairs(playerCharConnections) do
		if conn then
			pcall(function() conn:Disconnect() end)
		end
		playerCharConnections[pl] = nil
	end
	if espPlayerAddedConn then
		espPlayerAddedConn:Disconnect()
		espPlayerAddedConn = nil
	end
	if espPlayerRemovingConn then
		espPlayerRemovingConn:Disconnect()
		espPlayerRemovingConn = nil
	end
end

-- Teleport ao clicar (nova funcionalidade)
local function teleportCharacterTo(pos)
	local char = player.Character
	if not char then return end
	local hrp = char:FindFirstChild("HumanoidRootPart") or char:FindFirstChild("Torso") or char:FindFirstChild("UpperTorso")
	if not hrp then return end
	pcall(function()
		-- posiciona um pouco acima para evitar prender no chão
		hrp.CFrame = CFrame.new(pos + Vector3.new(0, 3, 0))
		-- limpar velocidade vertical para evitar queda estranha
		if hrp.AssemblyLinearVelocity then
			hrp.AssemblyLinearVelocity = Vector3.new(0,0,0)
		end
	end)
end

local function enableTeleportClick()
	if teleportEnabled then return end
	teleportEnabled = true
	teleportBtn.Text = "On"
	showNotification("Teleport click: Ativado", Color3.fromRGB(120, 200, 255))
	-- usar Mouse para registrar clique do jogador
	local mouse = player:GetMouse()
	if teleportConnection then
		teleportConnection:Disconnect()
		teleportConnection = nil
	end
	teleportConnection = mouse.Button1Down:Connect(function()
		-- evitar teleportar enquanto usuário está digitando em um TextBox da GUI
		if UserInputService:GetFocusedTextBox() then return end
		local hit = mouse.Hit
		local targetPos = (hit and hit.Position) or (hit and hit.p)
		if targetPos then
			teleportCharacterTo(targetPos)
		end
	end)
end

local function disableTeleportClick()
	if not teleportEnabled then return end
	teleportEnabled = false
	teleportBtn.Text = "Off"
	showNotification("Teleport click: Desativado", Color3.fromRGB(255,120,120))
	if teleportConnection then
		teleportConnection:Disconnect()
		teleportConnection = nil
	end
end

-- Keep settings applied when character spawns
player.CharacterAdded:Connect(function(char)
	local humanoid = char:FindFirstChildOfClass("Humanoid") or char:WaitForChild("Humanoid", 2)
	if humanoid then
		applySpeedToCharacter(char)
	end
	task.wait(0.1)
	if noclipEnabled then
		for _, part in ipairs(char:GetDescendants()) do
			if part:IsA("BasePart") then
				part.CanCollide = false
			end
		end
	end
	-- Reapply ESP highlight se ativado
	if espEnabled and char then
		local pl = Players:GetPlayerFromCharacter(char)
		if pl and pl ~= player then
			local h = createHighlightForChar(char)
			espHighlights[pl] = h
		end
	end
end)

-- Event hookups for toggles and controls

-- Speed box change and plus/minus
local function updateSpeedFromBox()
	local n = tonumber(speedBox.Text) or DEFAULT_WALKSPEED
	speedValue = clamp(math.floor(n), MIN_SPEED, MAX_SPEED)
	speedBox.Text = tostring(speedValue)
end

minusBtn.MouseButton1Click:Connect(function()
	updateSpeedFromBox()
	speedValue = clamp(speedValue - 1, MIN_SPEED, MAX_SPEED)
	speedBox.Text = tostring(speedValue)
end)

plusBtn.MouseButton1Click:Connect(function()
	updateSpeedFromBox()
	speedValue = clamp(speedValue + 1, MIN_SPEED, MAX_SPEED)
	speedBox.Text = tostring(speedValue)
end)

speedBox.FocusLost:Connect(function(enterPressed)
	updateSpeedFromBox()
end)

-- ESP toggle (agora abaixo do speed)
espBtn.MouseButton1Click:Connect(function()
	if espEnabled then
		disableESP()
	else
		enableESP()
	end
end)

-- Extra toggles
flyBtn.MouseButton1Click:Connect(function()
	if flyEnabled then
		disableFly()
	else
		enableFly()
	end
end)

ijBtn.MouseButton1Click:Connect(function()
	if infiniteJumpEnabled then
		disableInfiniteJump()
	else
		enableInfiniteJump()
	end
end)

noclipBtn.MouseButton1Click:Connect(function()
	if noclipEnabled then
		disableNoclip()
	else
		enableNoclip()
	end
end)

teleportBtn.MouseButton1Click:Connect(function()
	if teleportEnabled then
		disableTeleportClick()
	else
		enableTeleportClick()
	end
end)

-- Expand/Collapse behavior
local expanded = false
expandBtn.MouseButton1Click:Connect(function()
	expanded = not expanded
	extraFrame.Visible = expanded
	if expanded then
		frame.Size = UDim2.new(0, 220, 0, EXPANDED_HEIGHT)
		expandBtn.Text = "<"
	else
		frame.Size = UDim2.new(0, 220, 0, COLLAPSED_HEIGHT)
		expandBtn.Text = ">"
	end
end)

-- Initial state
disableNoclip()
speedBox.Text = tostring(DEFAULT_WALKSPEED)
speedValue = DEFAULT_WALKSPEED
startSpeedLoop()

-- Close button behavior: reset alguns estados e destruir GUI
closeButton.MouseButton1Click:Connect(function()
	local char = player.Character
	if char then
		local humanoid = char:FindFirstChildOfClass("Humanoid")
		if humanoid then
			humanoid.WalkSpeed = DEFAULT_WALKSPEED
		end
	end

	-- Desativar funcionalidades ativas
	disableNoclip()
	stopSpeedLoop()
	disableFly()
	disableInfiniteJump()
	disableESP()
	disableTeleportClick()

	-- limpar event connections criadas por este script (se existirem)
	if noclipConnection then
		pcall(function() noclipConnection:Disconnect() end)
		noclipConnection = nil
	end
	if speedConnection then
		pcall(function() speedConnection:Disconnect() end)
		speedConnection = nil
	end
	if flyConnection then
		pcall(function() flyConnection:Disconnect() end)
		flyConnection = nil
	end
	if ijConnection then
		pcall(function() ijConnection:Disconnect() end)
		ijConnection = nil
	end
	if teleportConnection then
		pcall(function() teleportConnection:Disconnect() end)
		teleportConnection = nil
	end

	-- destruir a GUI inteira
	if screenGui and screenGui.Parent then
		screenGui:Destroy()
	end
end)
